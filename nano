#!/usr/bin/env python3

from socket import *

import database 
import env 





def main():
    store = database.Database()

    with socket(AF_INET, SOCK_STREAM) as s:
        s.bind(env.ADDRESS)
        s.listen(1)
        conn, addr = s.accept()
        with conn:
            while True:
                command = conn.recv(1024).decode() 
                comlist = command.split()
                if comlist[0] == 'GET':
                    send_msg = store.get(comlist[1]).encode()
                    print('sending a new message ', send_msg)
                    s.send(send_msg) 
                elif comlist[0] == 'SET':
                    send_msg = store.set(comlist[1], comlist[2]).encode()
                    print('sending message')
                    s.send(send_msg)
                elif comlist[0] == 'DELETE':
                    send_msg = store.delete(comlist[1]).encode()
                    s.send(send_msg)
                else:
                    break 

                
 


if __name__ == '__main__':
    main()